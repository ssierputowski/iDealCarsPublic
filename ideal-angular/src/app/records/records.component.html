<app-header></app-header>

<script>
    var myApp = angular.module('myApp', []);

     myApp.controller('MyCtrl', function($scope) {
       $scope.currencyVal;
     });

     myApp.directive('phoneInput', function($filter, $browser) {
         return {
             require: 'ngModel',
             link: function($scope, $element, $attrs, ngModelCtrl) {
                 var listener = function() {
                     var value = $element.val().replace(/[^0-9]/g, '');
                     $element.val($filter('tel')(value, false));
                 };
      ngModelCtrl.$parsers.push(function(viewValue) {
                     return viewValue.replace(/[^0-9]/g, '').slice(0,10);
                 });
                 ngModelCtrl.$render = function() {
                     $element.val($filter('tel')(ngModelCtrl.$viewValue, false));
                 };

                 $element.bind('change', listener);
                 $element.bind('keydown', function(event) {
                     var key = event.keyCode;
                     if (key == 91 || (15 < key && key < 19) || (37 <= key && key <= 40)){
                         return;
                     }
                     $browser.defer(listener); // Have to do this or changes don't get picked up properly
                 });

                 $element.bind('paste cut', function() {
                     $browser.defer(listener);
                 });
             }

         };
     });
     myApp.filter('tel', function () {
         return function (tel) {
             console.log(tel);
             if (!tel) { return ''; }

             var value = tel.toString().trim().replace(/^\+/, '');

             if (value.match(/[^0-9]/)) {
                 return tel;
             }

             var country, city, number;

             switch (value.length) {
                 case 1:
                 case 2:
                 case 3:
                     city = value;
                     break;

                 default:
                     city = value.slice(0, 3);
                     number = value.slice(3);
             }

             if(number){
                 if(number.length>3){
                     number = number.slice(0, 3) + '-' + number.slice(3,7);
                 }
                 else{
                     number = number;
                 }

                 return ("(" + city + ") " + number).trim();
             }
             else{
                 return "(" + city;
             }

         };
     });
    </script>
<main>
  <div class="container-fluid">
    <div class="row">
      <div class="col-2 search-container">
        <mat-form-field color="accent">
          <mat-label>Customer Name</mat-label>
          <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Enter Customer Name">
        </mat-form-field>
        <button mat-raised-button color="accent">Filter</button>
        <p></p>
        <button mat-raised-button color="accent" (click)="openDialogEntry()">Add Customer</button>
      </div>
      <div class="col-10 records-container">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
          <!-- Customer Name Column -->
          <ng-container matColumnDef="customerName">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td class="customerSelect" mat-cell *matCellDef="let element" (click)="print(element.lastName + ', ' + element.firstName)">
              {{ element.lastName }}, {{ element.firstName }}
            </td>
          </ng-container>
          <!-- Customer Email Column -->
          <ng-container matColumnDef="customerEmail">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let element">{{ element.emailAddress }}</td>
          </ng-container>
          <!-- Customer Phone Column -->
          <ng-container matColumnDef="customerPhone">
            <th mat-header-cell *matHeaderCellDef>Phone Number</th>
            <td mat-cell *matCellDef="let element" mask='(000) 000-0000' >{{ element.phoneNumber }}
              </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  </div>
</main>

<!-- TESTTTTTT-->
<!-- <main>
  <div class="container-fluid">
    <div class="row">
      <div class="col-2 search-container">
        <button mat-raised-button color="accent" (click)="openDialogEntry()">Add Customer</button>
      </div>
      <div class="col-10 inventory-container">
        <table mat-table #table [dataSource]="dataSource" class="mat-elevation-z8" style="overflow: auto; width: 100%;">
          <ng-container matColumnDef="customerId">
            <th mat-header-cell *matHeaderCellDef>VIN</th>
            <td class="vehicleSelect" mat-cell *matCellDef="let element" (click)="print(element.customerId)">{{ element.customerId }}</td>
          </ng-container>
          <ng-container matColumnDef="firstName">
            <th mat-header-cell *matHeaderCellDef>Year</th>
            <td mat-cell *matCellDef="let element">{{ element.firstName }}</td>
          </ng-container>
          <ng-container matColumnDef="lastName">
            <th mat-header-cell *matHeaderCellDef>Make</th>
            <td mat-cell *matCellDef="let element">{{ element.lastName }}</td>
          </ng-container>
          <ng-container matColumnDef="phoneNumber">
            <th mat-header-cell *matHeaderCellDef>Model</th>
            <td mat-cell *matCellDef="let element">{{ element.phoneNumber }}</td>
          </ng-container>
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Color</th>
            <td mat-cell *matCellDef="let element">{{ element.email }}</td>
          </ng-container>
        </table>
      </div>
    </div>
  </div>
</main> -->



<!--
<main>
  <div class="container-fluid">
    <div class="row">
      <div class="col-2 search-container">
        <mat-form-field color="accent">
          <mat-label>Customer Name</mat-label>
          <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Enter Customer Name">
        </mat-form-field>
        <button mat-raised-button color="accent">Filter</button>
        <p></p>
        <button mat-raised-button color="accent" (click)="openDialogEntry()">Add Customer</button>
      </div>
      <div class="col-10 records-container">
        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

          <ng-container matColumnDef="customerName">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td class="customerSelect" mat-cell *matCellDef="let element" (click)="print(element.customerId)">
              {{ element.lastName }}, {{ element.firstName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="customerEmail">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let element">{{ element.email }}</td>
          </ng-container>

          <ng-container matColumnDef="customerPhone">
            <th mat-header-cell *matHeaderCellDef>Phone Number</th>
            <td mat-cell *matCellDef="let element">{{ element.phoneNumber }}</td>
          </ng-container>

          <ng-container matColumnDef="vehicleYear">
            <th mat-header-cell *matHeaderCellDef>Year</th>
            <td mat-cell *matCellDef="let element">
              <div *ngFor="let vehicle of element.vehicleInfo">
                <span>{{ vehicle.vehicleYear }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="vehicleMake">
            <th mat-header-cell *matHeaderCellDef>Make</th>
            <td mat-cell *matCellDef="let element">
              <div *ngFor="let vehicle of element.vehicleInfo">
                <span>{{ vehicle.vehicleMake }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="vehicleModel">
            <th mat-header-cell *matHeaderCellDef>Model</th>
            <td mat-cell *matCellDef="let element">
              <div *ngFor="let vehicle of element.vehicleInfo">
                <span>{{ vehicle.vehicleModel }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="vehicleColor">
            <th mat-header-cell *matHeaderCellDef>Color</th>
            <td mat-cell *matCellDef="let element">
              <div *ngFor="let vehicle of element.vehicleInfo">
                <span>{{ vehicle.vehicleColor }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="customerRecords">
            <th class="max-width" mat-header-cell *matHeaderCellDef>Service Records</th>
            <td class="max-width" mat-cell *matCellDef="let element">
              <button mat-raised-button color="primary">SHOW</button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  </div>
</main>
-->
