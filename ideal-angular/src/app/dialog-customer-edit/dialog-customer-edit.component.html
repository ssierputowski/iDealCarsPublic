<h2 mat-dialog-title *ngIf="edit">Edit {{this.data.lastName}}, {{this.data.firstName}} Data</h2>
<h2 mat-dialog-title *ngIf="!edit">{{this.data.lastName}}, {{this.data.firstName}}</h2>
<mat-dialog-content class="mat-typography">
  <mat-tab-group  #tabGroup (selectedTabChange)="tabChanged($event)">
    <!--     =================this is a TAB========================================================== -->
    <mat-tab label="Customer Info">
    <form [formGroup]="customerInfoForm" *ngIf="edit">
      <mat-form-field color="accent">
        <mat-label>First Name</mat-label>
        <input matInput type="text" formControlName="firstName">
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>Last Name</mat-label>
        <input matInput type="text" formControlName="lastName">
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>Phone Number</mat-label>
        <input matInput type="text" mask='(000) 000-0000' formControlName="phoneNumber">
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>Email</mat-label>
        <input matInput type="text" formControlName="emailAddress">
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>City</mat-label>
        <input matInput type="text" formControlName="city">
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>State</mat-label>
        <mat-select [formControl]="stateSelector" placeholder="PLEASE SELECT STATE">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let state of states" [value]="state">{{state}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field color="accent">
        <mat-label>ZipCode</mat-label>
        <input matInput type="text" formControlName="zipCode">
      </mat-form-field>
    </form>
    <form *ngIf="!edit">
        <div class="flex-container">
          <div>
            <h1 mat-dialog-title>{{ this.data.firstName }} {{ this.data.lastName }}</h1>
          </div>
        </div>
        <div class="flex-container">
            <h6>Customer ID</h6>
            <p >{{ this.data.customerId }}</p>
        </div>
        <div class="flex-container">
          <h6>Phone Number</h6>
          <p >{{ this.data.phoneNumber }}</p>
        </div>
        <div class="flex-container">
            <h6>Email Address</h6>
            <p >{{ this.data.emailAddress }}</p>
        </div>
         <div class="flex-container">
          <h6>Street Address</h6>
          <p >{{ this.data.address }}</p>
        </div>
        <div class="flex-container">
          <h6>City</h6>
          <p >{{ this.data.city }}</p>
        </div>
        <div class="flex-container">
          <h6>State</h6>
          <p >{{ this.data.state }}</p>
        </div>
        <div class="flex-container">
          <h6>Zipcode</h6>
          <p >{{ this.data.zipCode }}</p>
        </div>
      </form>
    </mat-tab>
    <!--     =================this is a TAB========================================================== -->
    <mat-tab label="Customer Vehicles">
      <form [formGroup]="customerVehicleForm" *ngIf="edit">
      <mat-form-field>
        <h6>Vehicle Year</h6>
        <input matInput type="text" formControlName="vehicleYear">
      </mat-form-field>
      <mat-form-field>
        <h6>Vehicle Make</h6>
        <input matInput type="text" formControlName="vehicleMake">
      </mat-form-field>
      <mat-form-field>
        <h6>Vehicle Model</h6>
        <input matInput type="text" formControlName="vehicleModel">
      </mat-form-field>
      <mat-form-field>
        <h6>Vehicle Color</h6>
        <input matInput type="text" formControlName="vehicleColor">
      </mat-form-field>
      <mat-form-field>
        <h6>Vehicle Details</h6>
        <input matInput type="text" formControlName="vehicleDetails">
      </mat-form-field>
      <mat-form-field>
        <h6>Vehicle Price Sold</h6>
        <input matInput type="text" formControlName="vehiclePriceSold">
      </mat-form-field>
      <div>
        <button mat-stroked-button type="button" (click)="filePicker.click()">PICK IMAGE</button>
          <input type="file" #filePicker (change)="onImagePicked($event)">
      </div>
      <div class="image-preview" *ngIf="imagePreview !== '' && imagePreview && customerVehicleForm.get('vehicleImage').valid">
        <img [src]="imagePreview" [alt]="customerVehicleForm.value.vehicleModel">
      </div>
    </form>
    <form *ngIf="!edit && !addVehicle">
      <mat-select [formControl]="vehicleSelector" placeholder="PLEASE SELECT CUSTOMER VEHICLE">
        <mat-option *ngFor="let car of cars" [value]="car">
        {{this.car?.make}} {{this.car?.model}}
        </mat-option>
      </mat-select>
        <div class="flex-container">
          <div align="center">
            <h6>{{ vehicleSelector.value?.make }} {{ vehicleSelector.value?.model}}</h6>
              <div class="image-preview">
                <img [src]="vehicleSelector.value?.carPic || ''">
              </div>
          </div>
          <div>
            <h1 mat-dialog-title>{{ vehicleSelector.value?.year }} {{ vehicleSelector.value?.make }} {{ vehicleSelector.value?.model }}</h1>
          </div>
        </div>
        <div class="flex-container">
          <h6>Vehicle Price Sold</h6>
          <p >{{ vehicleSelector.value?.pricePaid | currency }}</p>
        </div>
          <div class="flex-container">
          <h6>Vehicle VIN</h6>
          <p >{{ vehicleSelector.value?.carvin }}</p>
        </div>
        <div class="flex-container">
          <h6>Vehicle Color</h6>
          <p >{{ vehicleSelector.value?.color }}</p>
        </div>
        <div class="flex-container">
          <h6>Vehicle Detail</h6>
          <p >{{ vehicleSelector.value?.details }}</p>
        </div>
      </form>
      <form [formGroup]="addCustomerVehicleForm" *ngIf="addVehicle && tabIndex==1">
          <div class="flex-container">
              <h6>Customer ID</h6>
              <p >{{ this.data.customerId }}</p>
          </div>
          <mat-form-field>
            <h6>Vehicle VIN</h6>
            <input matInput type="text" formControlName="vehicleId">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Year</h6>
            <input matInput type="text" formControlName="vehicleYear">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Make</h6>
            <input matInput type="text" formControlName="vehicleMake">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Model</h6>
            <input matInput type="text" formControlName="vehicleModel">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Color</h6>
            <input matInput type="text" formControlName="vehicleColor">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Details</h6>
            <input matInput type="text" formControlName="vehicleDetails">
          </mat-form-field>
          <mat-form-field>
            <h6>Vehicle Price Sold</h6>
            <input matInput type="text" formControlName="vehiclePriceSold">
          </mat-form-field>
          <div>
            <button mat-stroked-button type="button" (click)="filePicker.click()">PICK IMAGE</button>
              <input type="file" #filePicker (change)="addOnImagePicked($event)">
          </div>
          <div class="image-preview" *ngIf="imagePreview !== '' && imagePreview && addCustomerVehicleForm.get('vehicleImage').valid">
            <img [src]="imagePreview" [alt]="addCustomerVehicleForm.value.vehicleModel">
          </div>
        </form>
    </mat-tab>
    <!--     =================this is a TAB========================================================== -->
    <mat-tab label="Customer Service Records">
        <form [formGroup]="customerServiceRecordForm" *ngIf="edit">
        <div class="flex-container">
            <h6>Customer ID</h6>
            <p >{{ this.data.customerId }}</p>
        </div>
        <div class="flex-container">
            <h6>Vehicle VIN</h6>
            <p >{{ this.recordSelector?.value.carvin }}</p>
        </div>
        <mat-form-field color="accent">
          <mat-label>Service Performed</mat-label>
          <input matInput type="text" formControlName="servicePerformed">
        </mat-form-field>
        <mat-form-field color="accent">
          <mat-label>Service Date</mat-label>
          <input matInput type="text" formControlName="serviceDate">
        </mat-form-field>
        <mat-form-field color="accent">
          <mat-label>Date Returned</mat-label>
          <input matInput type="text" formControlName="dateReturned">
        </mat-form-field>
        <mat-form-field color="accent">
          <mat-label>Mechanic</mat-label>
          <input matInput type="text" formControlName="mechanic">
        </mat-form-field>
        <mat-form-field color="accent">
          <mat-label>Service Notes</mat-label>
          <input matInput type="text" formControlName="serviceNotes">
        </mat-form-field>
        <mat-form-field color="accent">
          <mat-label>Service Price</mat-label>
          <input matInput type="text" formControlName="servicePrice">
        </mat-form-field>
        <mat-form-field color="accent">
        <h6>Payment Received</h6>
        <mat-select formControlName="paymentReceived">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let payStatus of payStatus" [value]="payStatus">{{payStatus}}</mat-option>
        </mat-select>
        </mat-form-field>
      </form>
      <form *ngIf="!edit &&!addRecord">
          <mat-select [formControl]="recordSelector" placeholder="PLEASE SELECT VEHICLE SERVICE RECORD">
              <mat-option *ngFor="let filteredRecord of filteredRecords" [value]="filteredRecord">
              {{this.filteredRecord?.date}}
              </mat-option>
            </mat-select>
          <div class="flex-container">
              <h6>Customer ID</h6>
              <p >{{ recordSelector.value?.custID }}</p>
          </div>
          <div class="flex-container">
              <h6>Vehicle VIN</h6>
              <p >{{ recordSelector.value?.carvin }}</p>
          </div>
          <div class="flex-container">
              <h6>Mileage</h6>
              <p >{{ recordSelector.value?.miles }}</p>
          </div>
          <div class="flex-container">
            <h6>Service Performed</h6>
            <p >{{ recordSelector.value?.service }}</p>
          </div>
          <div class="flex-container">
              <h6>Service Date</h6>
              <p >{{ recordSelector.value?.date}}</p>
          </div>
          <div class="flex-container">
            <h6>Date Returned</h6>
            <p >{{ recordSelector.value?.returnDate }}</p>
          </div>
          <div class="flex-container">
              <h6>Mechanic</h6>
              <p >{{ recordSelector.value?.mechanic }}</p>
          </div>
          <div class="flex-container">
            <h6>Notes:</h6>
            <p >{{ recordSelector.value?.note }}</p>
          </div>
          <div class="flex-container">
            <h6>Service Price</h6>
            <p >{{ recordSelector.value?.price | currency }}</p>
          </div>
          <div class="flex-container">
              <h6>Payment Received</h6>
              <p >{{ recordSelector.value?.payment }}</p>
          </div>
        </form>
        <form [formGroup]="addCustomerServiceRecordForm" *ngIf="addRecord && tabIndex==2">
            <div class="flex-container">
                <h6>Customer ID</h6>
                <p >{{ this.data.customerId }}</p>
            </div>
            <div class="flex-container">
                <h6>Vehicle VIN</h6>
                <p >{{ this.vehicleSelector?.value.carvin }}</p>
            </div>
            <mat-form-field color="accent">
              <mat-label>Service Performed</mat-label>
              <input matInput type="text" formControlName="servicePerformed">
            </mat-form-field>
            <mat-form-field color="accent">
              <mat-label>Service Date</mat-label>
              <input matInput type="text" formControlName="serviceDate">
            </mat-form-field>
            <mat-form-field color="accent">
              <mat-label>Date Returned</mat-label>
              <input matInput type="text" formControlName="dateReturned">
            </mat-form-field>
            <mat-form-field color="accent">
              <mat-label>Mechanic</mat-label>
              <input matInput type="text" formControlName="mechanic">
            </mat-form-field>
            <mat-form-field color="accent">
              <mat-label>Service Notes</mat-label>
              <input matInput type="text" formControlName="serviceNotes">
            </mat-form-field>
            <mat-form-field color="accent">
              <mat-label>Service Price</mat-label>
              <input matInput type="text" formControlName="servicePrice">
            </mat-form-field>
            <mat-form-field color="accent">
            <h6>Payment Received</h6>
            <mat-select formControlName="paymentReceived">
                <mat-option>None</mat-option>
                <mat-option *ngFor="let payStatus of payStatus" [value]="payStatus">{{payStatus}}</mat-option>
            </mat-select>
            </mat-form-field>
          </form>
      </mat-tab>
    <!--     =================this is END TAB========================================================== -->
  </mat-tab-group>
</mat-dialog-content>
<mat-dialog-actions *ngIf="edit" align="end">
  <button mat-raised-button type="submit" color="accent" [disabled]="customerInfoForm.invalid || customerVehicleForm.invalid || customerServiceRecordForm.invalid" (click)="saveEditedCustomerALL() && edit=false">SAVE ALL</button>
  <button mat-raised-button type="submit" color="accent" *ngIf="customerInfoForm.valid && tabIndex==0"(click)="saveEditedCustomerONLY() && edit=false">SAVE CUSTOMER</button>
  <button mat-raised-button type="submit" color="accent" *ngIf="customerVehicleForm.valid && tabIndex==1"(click)="saveEditedCustomerVehicleONLY() && edit=false">SAVE VEHICLE</button>
  <button mat-raised-button type="submit" color="accent" *ngIf="customerServiceRecordForm.valid && tabIndex==2"(click)="saveEditedCustomerServiceRecordONLY() && edit=false">SAVE SERVICE RECORD</button>

  <button mat-raised-button mat-dialog-close color="warn" *ngIf="edit && tabIndex==0" (click)="onDelete(this.data.id)">DELETE CUSTOMER</button>
  <button mat-raised-button mat-dialog-close color="warn" *ngIf="edit && tabIndex==1" (click)="onVehicleDelete(); edit=false;">DELETE VEHICLE</button>
  <button mat-raised-button mat-dialog-close color="warn" *ngIf="edit && tabIndex==2" (click)="onRecordDelete(); edit=false;">DELETE RECORD</button>
  <button mat-raised-button color="primary" (click)="edit=false">CANCEL</button>
</mat-dialog-actions>
<mat-dialog-actions *ngIf="!edit && !addVehicle && !addRecord" align="end">
  <button mat-raised-button type="submit" color="accent" (click)="edit=true">EDIT ALL</button>
  <button mat-raised-button mat-dialog-close color="primary" (click)="close()">CANCEL</button>
  <button mat-raised-button type="submit" color="accent" [disabled]="tabIndex!=1" (click)="addVehicle=true; addCustomerVehicle()">ADD VEHICLE</button>
  <button mat-raised-button type="submit" color="accent" [disabled]="tabIndex!=2" (click)="addRecord=true; addCustomerVehicleServiceRecord()">ADD RECORD</button>
</mat-dialog-actions>
<mat-dialog-actions *ngIf="addVehicle && tabIndex==1" align="end">
    <button mat-raised-button type="submit" color="accent" (click)="saveAddedCustomerVehicle(); addVehicle=false;">SAVE</button>
    <button mat-raised-button (click)="edit=false; addVehicle=false;" color="primary">CANCEL</button>
</mat-dialog-actions>
<mat-dialog-actions *ngIf="addRecord && tabIndex==2" align="end">
    <button mat-raised-button type="submit" color="accent" (click)="saveAddedCustomerVehicleServiceRecord(); addRecord=false;">SAVE</button>
    <button mat-raised-button (click)="edit=false; addRecord=false;" color="primary">CANCEL</button>
</mat-dialog-actions>
